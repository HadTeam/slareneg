## Backend

### 坐标定义 - 基本坐标系
- **原点 (0,0)**: 地图左上角
- **X轴**: 水平方向，向右递增 (列)
- **Y轴**: 垂直方向，向下递增 (行)
- **最大坐标**: 右下角为 (mapWidth-1, mapHeight-1)

基于上述坐标系，移动方向定义为：
- **up**: Y坐标减小 (向上移动)
- **down**: Y坐标增大 (向下移动)  
- **left**: X坐标减小 (向左移动)
- **right**: X坐标增大 (向右移动)

### API Provider
- **HTTP Service**: 处理认证、用户管理等HTTP请求
- **WebSocket Service**: 处理实时游戏通信
- **Auth Middleware**: JWT验证和权限控制

### Game Core
- **Room Manager**: 房间创建、匹配、管理
- **Game Engine**: 游戏逻辑核心
- **Turn System**: 回合管理和定时器
- **Conflict Resolver**: 多玩家操作冲突判定

### Data Layer
- **Cache Layer (Redis)**: 
  - 游戏状态缓存
  - 用户会话管理
  - 房间信息缓存
- **Database (MySQL/PostgreSQL)**:
  - 用户账户信息
  - 游戏历史记录
  - 排行榜数据

### Message Queue
- **Redis Pub/Sub**: 实时消息广播
- **指令队列**: 玩家操作排队处理

## 定时任务系统

### 回合定时器
- 每回合固定时长（默认30秒）
- 自动结束超时回合
- 触发新回合开始

### 资源增长
- 城市单位自动增长
- 领土收益计算

### 状态检查
- 游戏胜负判定
- 玩家连接状态监控
- 数据同步检查

## 数据持久化策略

### 实时数据 (Cache)
- 当前游戏状态
- 玩家操作队列
- 房间信息

### 持久化数据 (Database)  
- 用户账户
- 游戏历史
- 统计数据
- 排行榜

### 同步机制
- 游戏结束时批量写入数据库
- 关键操作实时备份
- 定期数据一致性检查